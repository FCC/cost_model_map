{% include header.html %}

<div id="title" class="container">
  <div class="content">
    <h3>{{ site.title }}</h3>
  </div>
</div>
<div id="map-c" class="container">
  <div class="content">
    <div id="map"></div>
    <div id='map-ui'>
      <ul>
        <li><a href='javascript:void(0)' id='mayor' class='sel active'>FCC Speed Test Participation</a></li>
        <li><a href='javascript:void(0)' id='ds_all' class='sel inactive'>Combined Download Speed</a></li>
        <li><a href='javascript:void(0)' id='ds_att' class='sel inactive'>ATT - Download Speed</a></li>
        <li><a href='javascript:void(0)' id='ds_sprint' class='sel inactive'>Sprint - Download Speed</a></li>
        <li><a href='javascript:void(0)' id='ds_tmobile' class='sel inactive'>T-Mobile - Download Speed</a></li>
        <li><a href='javascript:void(0)' id='ds_vz' class='sel inactive'>Verizon - Download Speed</a></li>
      </ul>
    </div>
    <div id="map-titleBlock">
      <h1 id="map-hd">FCC Mobile Speed Test </h1>
      <a class="lnk-about" href="http://www.fcc.gov/measuring-broadband-america/mobile" target="about_map">About &raquo;</a>
      <div id="map-desc">This map represents the number of mobile speed tests collected to date on all networks by the FCC Mobile Speed Test app. These are early results, and the maps are a work in progress. The intent is to show preliminary activity from the project. Crowdsourced maps evolve and change over time as more users participate in the program; to contribute your results, download the FCC Speed Test app from the <a href="https://play.google.com/store/apps/details?id=com.samknows.fcc&hl=en" target="google_play">Google Play</a> or <a href="https://itunes.apple.com/us/app/fcc-speed-test/id794322383?mt=8&uo=4" target="app_store">iTunes app store</a>.</div>      
    </div>
  </div>
</div>
   
<script>
var map = L.mapbox.map('map', 'fcc.map-kzt95hy6', {attributionControl: false,maxZoom:8})
            .setView([40.58, -75.21], 6);
var hash = L.hash(map);
L.control.fullscreen().addTo(map);

var activeLayerGroup = new L.LayerGroup();
// var mayor_TL = L.mapbox.tileLayer('fcc.xtwng66r')
//                     .on('load',function(){map.legendControl.addLegend(mayor_TL.getTileJSON().legend);
//                                         mayor_TL.removeEventListener();})

// var mayor_GL = L.mapbox.gridLayer('fcc.xtwng66r')
var mayor_TL = L.mapbox.tileLayer('fcc.xtwng66r')
                    .on('load',function(){map.legendControl.addLegend(mayor_TL.getTileJSON().legend);
                                        mayor_TL.removeEventListener();})
var mayor_GL = L.mapbox.gridLayer('fcc.xtwng66r')
var mayor_GC = L.mapbox.gridControl(mayor_GL, {follow: true})//.addTo(map);
var tileName = "mayor";

activeLayerGroup.addLayer(mayor_TL);
activeLayerGroup.addLayer(mayor_GL);
activeLayerGroup.addLayer(mayor_GC);
activeLayerGroup.addTo(map,function(){console.log('done')});
map.legendControl.addLegend(mayor_TL.getTileJSON().legend);

var ds_all_TL = L.mapbox.tileLayer('fcc.lwok1emi');
var ds_all_GL = L.mapbox.gridLayer('fcc.lwok1emi');
var ds_all_GC = L.mapbox.gridControl(ds_all_GL, {follow: true});

var ds_att_TL = L.mapbox.tileLayer('fcc.0novfgvi');
var ds_att_GL = L.mapbox.gridLayer('fcc.0novfgvi');
var ds_att_GC = L.mapbox.gridControl(ds_att_GL, {follow: true});
 
var ds_sprint_TL = L.mapbox.tileLayer('fcc.vy722o6r');
var ds_sprint_GL = L.mapbox.gridLayer('fcc.vy722o6r');
var ds_sprint_GC = L.mapbox.gridControl(ds_sprint_GL, {follow: true});
 
var ds_tmobile_TL = L.mapbox.tileLayer('fcc.xuwyiudi');
var ds_tmobile_GL = L.mapbox.gridLayer('fcc.xuwyiudi');
var ds_tmobile_GC = L.mapbox.gridControl(ds_tmobile_GL, {follow: true});
 
var ds_vz_TL = L.mapbox.tileLayer('fcc.y9nc23xr');
var ds_vz_GL = L.mapbox.gridLayer('fcc.y9nc23xr');
var ds_vz_GC = L.mapbox.gridControl(ds_vz_GL, {follow: true});

// var ds_mask_TL = L.mapbox.tileLayer('fcc.vl2chaor');
// var ds_mask_GL = L.mapbox.gridLayer('fcc.vl2chaor');
// var ds_mask_GC = L.mapbox.gridControl(ds_mask_GL, {follow: true});

var mapHd = {
  mayor: {
    title: 'FCC Mobile Speed Test',
    description: 'This map represents the number of mobile speed tests collected to date on all networks by the FCC Mobile Speed Test app. These are early results, and the maps are a work in progress. The intent is to show preliminary activity from the project. Crowdsourced maps evolve and change over time as more users participate in the program; to contribute your results, download the FCC Speed Test app from the <a href="https://play.google.com/store/apps/details?id=com.samknows.fcc&hl=en" target="_new">Google Play</a> or <a href="https://itunes.apple.com/us/app/fcc-speed-test/id794322383?mt=8&uo=4" target="_new">iTunes app store</a>.'  
  },
  ds_all: {
    title: 'Median Speeds - Combined',
    description: 'This map represents the median mobile download speed for tests collected to date on all networks by the FCC Mobile Speed Test app. These are early results, and the maps are a work in progress. The intent is to show preliminary activity from the project. Crowdsourced maps evolve and change over time as more users participate in the program; to contribute your results, download the FCC Speed Test app from the <a href="https://play.google.com/store/apps/details?id=com.samknows.fcc&hl=en" target="_new">Google Play</a> or <a href="https://itunes.apple.com/us/app/fcc-speed-test/id794322383?mt=8&uo=4" target="_new">iTunes app store</a>.'  
  },
  ds_att: {
    title: 'Median Speeds - AT&T',
    description: 'This map represents the median mobile download speed for tests collected to date on the AT&T network by the FCC Mobile Speed Test app. These are early results, and the maps are a work in progress. The intent is to show preliminary activity from the project. Crowdsourced maps evolve and change over time as more users participate in the program; to contribute your results, download the FCC Speed Test app from the <a href="https://play.google.com/store/apps/details?id=com.samknows.fcc&hl=en" target="_new">Google Play</a> or <a href="https://itunes.apple.com/us/app/fcc-speed-test/id794322383?mt=8&uo=4" target="_new">iTunes app store</a>.'  
  },
  ds_sprint: {
    title: 'Median Speeds - Sprint',
    description: 'This map represents the median mobile download speed for tests collected to date on the Sprint network by the FCC Mobile Speed Test app. These are early results, and the maps are a work in progress. The intent is to show preliminary activity from the project. Crowdsourced maps evolve and change over time as more users participate in the program; to contribute your results, download the FCC Speed Test app from the <a href="https://play.google.com/store/apps/details?id=com.samknows.fcc&hl=en" target="_new">Google Play</a> or <a href="https://itunes.apple.com/us/app/fcc-speed-test/id794322383?mt=8&uo=4" target="_new">iTunes app store</a>.'  
  },
  ds_tmobile: {
    title: 'Median Speeds - T-Mobile',
    description: 'This map represents the median mobile download speed for tests collected to date on the T-Mobile network by the FCC Mobile Speed Test app. These are early results, and the maps are a work in progress. The intent is to show preliminary activity from the project. Crowdsourced maps evolve and change over time as more users participate in the program; to contribute your results, download the FCC Speed Test app from the <a href="https://play.google.com/store/apps/details?id=com.samknows.fcc&hl=en" target="_new">Google Play</a> or <a href="https://itunes.apple.com/us/app/fcc-speed-test/id794322383?mt=8&uo=4" target="_new">iTunes app store</a>.'  
  },
  ds_vz: {
    title: 'Median Speeds - Verizon',
    description: 'This map represents the median mobile download speed for tests collected to date on the Verizon network by the FCC Mobile Speed Test app. These are early results, and the maps are a work in progress. The intent is to show preliminary activity from the project. Crowdsourced maps evolve and change over time as more users participate in the program; to contribute your results, download the FCC Speed Test app from the <a href="https://play.google.com/store/apps/details?id=com.samknows.fcc&hl=en" target="_new">Google Play</a> or <a href="https://itunes.apple.com/us/app/fcc-speed-test/id794322383?mt=8&uo=4" target="_new">iTunes app store</a>.' 
  }
}

d3.selectAll(".sel").on("click", function(){
    if (d3.select(this).classed("active")){
        //do nothing
    } else {
        d3.select('.map-legend').remove();
        d3.selectAll(".sel").attr("class","sel inactive");
        d3.select(this).attr("class","sel active");
         map.legendControl.removeLegend(eval(tileName+"_TL").getTileJSON().legend);
         tileName = d3.select(this).attr("id");
        activeLayerGroup.clearLayers();
       
    activeLayerGroup.addLayer(eval(tileName+"_TL"));
        activeLayerGroup.addLayer(eval(tileName+"_GL"));
        activeLayerGroup.addLayer(eval(tileName+"_GC"));
  //  activeLayerGroup.addLayer(eval(ds_mask_TL));
        map.legendControl.addLegend(eval(tileName+"_TL").getTileJSON().legend);
    
    d3.select('#map-hd').text(mapHd[this.id].title);
    d3.select('#map-desc').html(mapHd[this.id].description);    
    }
});
 
</script>

{% include footer.html %}